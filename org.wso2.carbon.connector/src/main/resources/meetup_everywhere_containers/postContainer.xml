<template name="postContainer" xmlns="http://ws.apache.org/ns/synapse">

    <!-- Required Parameters -->
    <parameter name="key" description="API key" />
    <parameter name="name" description="Name of this container" />

    <!-- Optional parameters -->
    <parameter name="description" description="Description of this container" />
    <parameter name="facebook_urlname" description="path name without slashes" />
    <parameter name="link" description="must be a URL" />
    <parameter name="link_name" description="Name of link" />
    <parameter name="twitter_urlname" description="account name" />

    <sequence>
        <property name="uri.var.key" expression="$func:key" />
        <property name="uri.var.name" expression="$func:name" />
        <property name="uri.var.description" expression="$func:description" />
        <property name="uri.var.facebook_urlname" expression="$func:facebook_urlname" />
        <property name="uri.var.link" expression="$func:link" />
        <property name="uri.var.link_name" expression="$func:link_name" />
        <property name="uri.var.twitter_urlname" expression="$func:twitter_urlname" />


        <filter xpath="get-property('uri.var.key') != '' and get-property('uri.var.name') != ''">

            <then>


                <payloadFactory media-type="xml">
                    <format>
                        <root>
                            <key>$1</key>
                            <name>$2</name>
                            <description>$3</description>
                            <facebook_urlname>$4</facebook_urlname>
                            <link>$5</link>
                            <link_name>$6</link_name>
                            <twitter_urlname>$7</twitter_urlname>

                        </root>
                    </format>

                    <args>
                        <arg expression="get-property('uri.var.key')" />
                        <arg expression="get-property('uri.var.name')" />
                        <arg expression="get-property('uri.var.description')" />
                        <arg expression="get-property('uri.var.facebook_urlname')" />
                        <arg expression="get-property('uri.var.link')" />
                        <arg expression="get-property('uri.var.link_name')" />
                        <arg expression="get-property('uri.var.twitter_urlname')" />



                    </args>



                </payloadFactory>

            </then>


        </filter>




  		<property name="messageType" scope="axis2" value="application/x-www-form-urlencoded" />
		<property name="DISABLE_CHUNKING" value="true" scope="axis2"></property>

        <log level="custom" xmlns="http://ws.apache.org/ns/synapse">
            <property name="string" expression="fn:concat('key - ', get-property('uri.var.key'))" />
        </log>
        <log level="custom" xmlns="http://ws.apache.org/ns/synapse">
            <property name="string" expression="fn:concat('name - ', get-property('uri.var.name'))"/>
        </log>
        <log level="custom" xmlns="http://ws.apache.org/ns/synapse">
            <property name="string" expression="fn:concat('description - ', get-property('uri.var.description'))"/>
        </log>


        <call>
			<endpoint>
				<http method="post"
					uri-template="{uri.var.apiUrl}/ew/container " />
			</endpoint>
		</call>
		<!-- Remove response custom header information -->
		<header name="X-LI-UUID" scope="transport" action="remove" />
		<header name="X-Li-Fabric" scope="transport" action="remove" />
		<header name="x-li-request-id" scope="transport" action="remove" />
		<header name="X-Li-Pop" scope="transport" action="remove" />
		<header name="Set-Cookie" scope="transport" action="remove" />

	</sequence>
</template>
